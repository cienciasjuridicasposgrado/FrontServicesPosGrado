<div class="dashboard-grid">
  
  <!-- Carga y Mensaje de Bienvenida -->
  <mat-card class="welcome-card" *ngIf="!loading">
    <mat-card-title>
      <mat-icon color="primary">waving_hand</mat-icon> ¡Bienvenido, {{ user?.nombre || 'Administrador' }}!
    </mat-card-title>
    <mat-card-subtitle>
      Tu rol actual es: {{ user?.role?.name || 'N/A' }}. 
      Revisa las métricas clave a continuación.
    </mat-card-subtitle>
  </mat-card>

  <!-- Grid de Estadísticas -->
  <div class="stats-grid" *ngIf="stats && !loading">
    <!-- Total Ítems -->
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon bg-blue-100 text-blue-800"><mat-icon>inventory_2</mat-icon></div>
        <div class="stat-info">
          <p class="stat-value">{{ stats.total_items }}</p>
          <p class="stat-label">Ítems Registrados</p>
        </div>
    </mat-card-content>
    </mat-card>
    
    <!-- Total Entradas -->
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon bg-green-100 text-green-800"><mat-icon>move_to_inbox</mat-icon></div>
        <div class="stat-info">
          <p class="stat-value">{{ stats.total_entries }}</p>
          <p class="stat-label">Entradas Totales</p>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Total Salidas -->
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-icon bg-red-100 text-red-800"><mat-icon>outbox</mat-icon></div>
        <div class="stat-info">
          <p class="stat-value">{{ stats.total_outputs }}</p>
          <p class="stat-label">Salidas Totales</p>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Ítems con Stock Bajo -->
    <mat-card class="stat-card low-stock-alert">
      <mat-card-content>
        <div class="stat-icon bg-yellow-100 text-yellow-800"><mat-icon>warning</mat-icon></div>
        <div class="stat-info">
          <p class="stat-value">{{ stats.low_stock_items }}</p>
          <p class="stat-label">Stock Bajo</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Actividad Reciente -->
  <mat-card class="activity-card" *ngIf="!loading">
    <mat-card-title>Actividad Reciente</mat-card-title>
    <mat-card-content>
      <div class="activity-list">
        <div *ngIf="recentActivities.length === 0" class="no-activity">
            <mat-icon>info</mat-icon> No hay actividad reciente registrada.
        </div>
        <div *ngFor="let activity of recentActivities" class="activity-item">
          <mat-icon [color]="getActivityColor(activity)">{{ getActivityIcon(activity) }}</mat-icon>
          <div class="activity-details">
            <span class="activity-type">{{ getActivityLabel(activity) }}</span>
            <span class="activity-description">
              **{{ activity.cantidad }}** unid. de **{{ activity.item_nombre }}**
              <span *ngIf="activity.type === 'output'"> hacia {{ activity.departamento }}</span>
            </span>
          </div>
          <span class="activity-date">{{ activity.fecha | date: 'shortTime' }}</span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Spinner de Carga Central -->
  <div *ngIf="loading" class="spinner-center-full">
    <mat-spinner diameter="60"></mat-spinner>
    <p>Cargando datos del dashboard...</p>
  </div>
</div>